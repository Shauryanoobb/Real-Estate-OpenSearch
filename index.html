<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Real Estate Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">

    <div class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow">
        <h1 class="text-2xl font-bold mb-4">Search Properties</h1>

        <!-- Search Form -->
        <div class="grid grid-cols-2 gap-4 mb-6">

            <input id="locality" class="p-2 border rounded" placeholder="Locality">
            <input id="keywords" class="p-2 border rounded" placeholder="Description keywords">
            <input id="title_keywords" class="p-2 border rounded" placeholder="Title keywords">

            <input id="bhk" type="number" class="p-2 border rounded" placeholder="BHK">
            <input id="min_sqft" type="number" class="p-2 border rounded" placeholder="Min Sqft">
            <input id="max_sqft" type="number" class="p-2 border rounded" placeholder="Max Sqft">

            <input id="min_price" type="number" class="p-2 border rounded" placeholder="Min Price">
            <input id="max_price" type="number" class="p-2 border rounded" placeholder="Max Price">

            <select id="is_furnished" class="p-2 border rounded">
                <option value="">Furnished?</option>
                <option value="true">Yes</option>
                <option value="false">No</option>
            </select>

            <select id="has_lift" class="p-2 border rounded">
                <option value="">Lift Available?</option>
                <option value="true">Yes</option>
                <option value="false">No</option>
            </select>

        </div>

        <button onclick="search()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            Search
        </button>

        <h2 class="text-xl font-semibold mt-6">Results:</h2>
        <div id="results" class="mt-4 space-y-4"></div>
    </div>

    <script>
        async function search() {
            const params = new URLSearchParams();

            const fields = [
                "locality",
                "keywords",
                "title_keywords",
                "bhk",
                "min_sqft",
                "max_sqft",
                "min_price",
                "max_price",
                "is_furnished",
                "has_lift"
            ];

            fields.forEach(f => {
                const value = document.getElementById(f).value;
                if (value !== "") params.append(f, value);
            });

            const url = "http://localhost:8000/properties/search/?" + params.toString();

            const res = await fetch(url);
            const data = await res.json();

            const container = document.getElementById("results");
            container.innerHTML = "";

            data.hits.hits.forEach(hit => {
                const p = hit._source;
                container.innerHTML += `
                    <div class="p-4 border rounded-lg bg-gray-50">
                        <h3 class="text-lg font-bold">${p.title}</h3>
                        <p>${p.locality}</p>
                        <p>${p.bhk} BHK • ${p.sqft} sqft</p>
                        <p>₹${p.price}</p>
                        <p class="text-gray-600">${p.description}</p>
                    </div>
                `;
            });
        }
    </script>

</body>
</html>
